<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- 파비콘(favicon) 설정 링크 -->
<link rel="shortcut icon"
href="http://192.168.10.84/images/favicon.ico"/>
<!-- 부트스트랩  CDN -->    
<link rel="stylesheet" type="text/css"
href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"/>
<!-- jquery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<!-- Vue CDN -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<!-- Axios CDN -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<style type="text/css">

</style>

<script type="text/javascript">
$(function(){

});

</script>
</head>
<body>
<div id="app">
<h2>회원등록</h2>
<label>아이디</label><input type="text" v-model="newMember.id"/><br>
<label>이름</label><input type="text" v-model="newMember.name"/><br>
<label>나이</label><input type="text" v-model="newMember.age"/><br>
<input type="button" value="추가" @Click="addMember" class="btn btn-success btn-sm" />
<div v-html="msg"></div>
<div v-html="msg2"></div>
<div>
<input type="button" value="전체회원검색" @Click="searchMember" class="btn btn-info btn-sm" />
<table class="table table-hover">
<thead>
<tr>
	<th>번호</th>
	<th>아이디</th>
	<th>이름</th>
	<th>나이</th>
	<th>수정/삭제</th>
</tr>
</thead>
<tbody>
<tr v-if="members.length==0">
<td colspan="5">입력된 회원 정보가 존재하지 않습니다.</td>
</tr>
<tr v-for="(member, ind) in members" :key="member.id">
	<td>{{ind+1 }}</td>
	<td>{{member.id}}</td>
	<td>{{member.name}}</td>
	<td>{{member.age}}</td>
	<td>
	<input type="button" value="삭제" @Click="removeMember(member.id)" class="btn btn-danger brn-sm">
	<input type="button" value="변경" @Click="editMember(member)" class="btn btn-primary brn-sm">
	</td>
	
</tr>
</tbody>
</table>
</div>
<div v-if="editData.id"><!-- JSONObject의 id 속성에 값이 있다면 true, 없으면 false -->
<h2>회원수정</h2>
<!-- 깊은 복사를 하여 입력된 객체와 수정할 객체가 같은 값을 가지지만 다른 주소를 사용하게 된다. -->
<!-- 복사된 객체를 수정하더라도 원본객체에 영행을 주지 않는다. -->
<label>아이디</label><input type="text" v-model="editData.id"/><br>
<label>이름</label><input type="text" v-model="editData.name"/><br>
<label>나이</label><input type="text" v-model="editData.age"/><br>
<input type="button" value="변경" @Click="modifyMember" class="btn btn-success btn-sm" />
</div>

</div>
<script>
var preUrl="/app1";
Vue.createApp({
    data(){
        return{ newMember:{ id:"", name:"", age:0 },
        msg:"",
        msg2:"",
        members:[],
        editData:{id:"", name:"", age:0 }
        }
    },
    methods:{
    	addMember(){
    		//back-end ( RestController )로 전달
    		//axios.post("/url",jsonObj).then(res=>{}).catch(err=>{});
    		axios.post(`${preUrl}/member`,this.newMember)
    		.then( res =>{
    			this.msg2=`${this.newMember.id}로 추가한 결과 ${res.data.message}`;
    			//html이 실행되지 않는다.
    			//alert("성공 : " + res.data.message+' ,'+res.data.flag);
    			this.newMember={id:"", name:"",age:0};
    			this.searchMember();//입력한 것 바로 반영
    		})
    		.catch( err =>{
    			alert("실패 : " + err);
    			console.log(`추가 : ${err}`);
    			
    		});
    	},
    	searchMember(){
    		axios.get(`${preUrl}/members`)
    		.then(res =>{
 				this.members=res.data;//JSONArr
    			this.msg="<marquee>회원정보 검색 성공</marquee>";
    		})
    		.catch(err =>{
    			this.msg="회원정보 검색 중 문제 발생";
    			console.log(`검색 : ${err}`);
    		});
    		
    	},
    	removeMember(id){
    		//axios.delete("/url",jsonObj).then(res=>{}).catch(err=>{});
    		axios.delete(`${preUrl}/members/${id}`)
    		.then(res=>{
    			this.msg2="회원정보가 성공적으로 삭제하였습니다.";
    			this.searchMember();
    		})
    		.catch(err=>{
    			this.msg2="회원정보 삭제 중 문제 발생";
    			console.log(`삭제 : ${err}`);
    		});
    	},
    	editMember(member){
			this.editData={...member };
    	},
    	modifyMember(){
    		//axios.put("/url",값).then(res=>{}).catch(err=>{});
    		axios.put(`${preUrl}/members/${this.editData.id}`,this.editData)
    		.then(res=>{
    			this.msg2=res.data.message;
    			this.searchMember();//vue 갱신
    			this.editData={id:"", name:"", age:0 }; //수정 폼이 사라진다.
    		})
    		.catch(err=>{
    			this.msg2="회원정보 변경 중 문제 발생";
    			console.log(`변경 : ${err}`);
    		});
    	}
    }
}).mount("#app");

</script>
</body>
</html>